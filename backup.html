<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        :root {
            --dot-size: 0.6rem;
            --hover-color: #f97316;
            --line-color: #e1e4e8;
            --line-width: 0.15rem;
        }

        .commit_list_views {
            padding: 0;
            margin: 0;
            list-style-type: none;
            width: fit-content;
        }

        .commit {
            font-size: 14px;
            display: flex;
            align-items: flex-start;
            gap: 8px;
            padding-bottom: 20px;
            position: relative;
        }

        .commit:last-child {
            padding-bottom: 0;
        }

        .commit:not(:last-child)::before {
            content: "";
            display: block;
            position: absolute;
            left: calc(var(--dot-size) / 2 + var(--line-width) / 2);
            top: 5px;
            bottom: -5px;
            width: var(--line-width);
            background-color: var(--line-color);
        }
        
        .commit_tree_dot {
            transition: transform .2s;
        }

        .commit_text {
            padding-left: 1.2rem;
            transform-origin: left;
            transition: transform .2s;
        }

        .commit>.commit_tree_dot {
            margin-top: 0.3rem;
            position: absolute;
            width: var(--dot-size);
            height: var(--dot-size);
            border-radius: 50%;
            border: solid 2px var(--line-color);
            z-index: 1;
            flex-shrink: 0;
            background-color: white;
            transition: border .2s;
        }

        .commit_hash {
            color: #999;
            margin-left: 8px;
            font-size: 0.68rem;
            padding: 0.22rem;
            border-radius: 0.2rem 0.25rem;
            background-color: var(--line-color);
        }

        .commit:hover > .commit_tree_dot {
            border: solid 2px var(--hover-color);
            transform: scale(1.2);
        }

        .commit:hover > .commit_text {
            transform: scale(1.05);
        }
    </style>
</head>

<body>
    <h2> update logs</h2>
    <div id="commit_logs">

    </div>
</body>
<script>
    async function getCommits(name, repo) {
        const resp = await fetch(`https://api.github.com/repos/${name}/${repo}/commits`)

        if (resp.ok) {
            return resp.json();
        } else {
            throw new Error(resp);
        }
    }

    const commitLogsContainer = document.getElementById('commit_logs');

    async function createCommitViews() {
        const resp = await getCommits('mocadayoo', 'handtracking');
        const dateGroup = resp.reduce((acc, commit) => {
            const date = new Date(commit.commit.author.date);
            const title = date.toLocaleDateString('en-US', {
                month: 'short', day: 'numeric', year: 'numeric'
            });

            if (!acc[title]) acc[title] = [];
            acc[title].push({
                shortMessage: commit.commit.message.split('\n')[0],
                hash: commit.sha
            });
            return acc;
        }, {});

        Object.keys(dateGroup).forEach(title => {
            const viewTitle = document.createElement('h4');
            viewTitle.textContent = title;

            const ul = document.createElement('ul');
            ul.className = 'commit_list_views';
            ul.appendChild(viewTitle)

            dateGroup[title].forEach(commit => {
                const li = document.createElement('li');
                li.className = 'commit';
                li.innerHTML = `
                <div class="commit_tree_dot"></div>
                <div class="commit_text"><span>${commit.shortMessage}</span><label class="commit_hash">${commit.hash.substring(0, 6)}</label></div>
            `;
                ul.appendChild(li);
            });
            commitLogsContainer.appendChild(ul);
        });
    }

    createCommitViews();
</script>

</html>